<!DOCTYPE html>
<html>
    <body>
        <div>
            <input type="file" accept=".sl2">
        </div>

        <div id="weapon" style="display: inline-block; vertical-align: top;"></div>
        <div id="armor" style="display: inline-block; vertical-align: top;"></div>
        <div id="ash" style="display: inline-block; vertical-align: top;"></div>
        <div id="talisman" style="display: inline-block; vertical-align: top;"></div>
        <div id="goods" style="display: inline-block; vertical-align: top;"></div>
        <div id="keyitems" style="display: inline-block; vertical-align: top;"></div>

        <script type="module">
            import { SaveData } from './src/savedata.js'

            function showFile() {
                let file = document.querySelector('input[type=file]').files[0];
                console.log(file);
                if(!file)
                    return;
                let reader = new FileReader();
                reader.onload = function (event) {
                    let savedata = new SaveData(reader.result);

                    console.log(savedata);

                    let inventory = savedata.characters[0].inventory.filter(x => x.name !== undefined);

                    let keyitems = savedata.characters[0].keyitems.filter(x => x.name !== undefined);

                    keyitems.sort((a,b) => {
                        return a.name.localeCompare(b.name)
                    });

                    document.getElementById('keyitems').innerHTML = "";

                    keyitems.forEach(item => {
                        let i = document.createElement("div");
                        let itemString = item.name;
                        i.appendChild(document.createTextNode(itemString));
                        document.getElementById('keyitems').appendChild(i);
                    })

                    let update = (type) => {
                        let items = inventory.filter(x => x.type == type);

                        items.sort((a,b) => {
                            return a.name.localeCompare(b.name)
                        });

                        document.getElementById(type).innerHTML = "";

                        items.forEach(item => {
                            let i = document.createElement("div");
                            let itemString = item.name;
                            if(item.qty > 1)
                                itemString += ' x' + item.qty;
                            i.appendChild(document.createTextNode(itemString));
                            document.getElementById(type).appendChild(i);
                        })
                    }

                    update('weapon')
                    update('armor')
                    update('ash')
                    update('talisman')
                    update('goods')
                }
                reader.readAsArrayBuffer(file);
            }

            document.querySelector('input').addEventListener('change', showFile);
        </script>
    </body>
</html>